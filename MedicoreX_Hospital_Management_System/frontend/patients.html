
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Patients Management - MediCoreX Hospital Management System</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <header>
        <div class="container">
            <div class="logo">
                <img src="images/hospital-logo.png" alt="Hospital Logo" onerror="this.style.display='none'">
                <h1>MediCoreX Hospital</h1>
            </div>
            <nav>
                <ul>
                    <li><a href="dashboard.html">Dashboard</a></li>
                    <li><a href="patients.html">Patients</a></li>
                    <li><a href="doctors.html">Doctors</a></li>
                    <li><a href="appointments.html">Appointments</a></li>
                    <li><a href="billing.html">Billing</a></li>
                    <li><a href="reports.html">Reports</a></li>
                    <li><a href="index.html" id="logoutBtn">Logout</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <main class="container">
        <div class="card">
            <div class="card-header">
                <h2>Patient Management</h2>
            </div>

            <div id="alert-container"></div>

            <div class="search-box">
                <input type="text" id="searchPatient" class="form-control" placeholder="Search patients by name, ID, or phone...">
                <button class="btn btn-primary" onclick="searchPatients()">Search</button>
                <button class="btn btn-success" onclick="showAddPatientModal()">Add New Patient</button>
            </div>

            <div class="table-responsive">
                <table>
                    <thead>
                        <tr>
                            <th>Patient ID</th>
                            <th>Name</th>
                            <th>Age</th>
                            <th>Gender</th>
                            <th>Phone</th>
                            <th>Email</th>
                            <th>Blood Group</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="patientsTableBody">
                        <tr>
                            <td colspan="8">Loading patients...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </main>

    <!-- Add/Edit Patient Modal -->
    <div id="patientModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">Add New Patient</h2>
                <span class="close" onclick="closePatientModal()">&times;</span>
            </div>
            <form id="patientForm">
                <input type="hidden" id="patientId">
                
                <div class="form-group">
                    <label for="patientName">Full Name *</label>
                    <input type="text" id="patientName" class="form-control" required>
                </div>

                <div class="stats-container">
                    <div class="form-group">
                        <label for="patientAge">Age *</label>
                        <input type="number" id="patientAge" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="patientGender">Gender *</label>
                        <select id="patientGender" class="form-control" required>
                            <option value="">Select Gender</option>
                            <option value="Male">Male</option>
                            <option value="Female">Female</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label for="patientPhone">Phone Number *</label>
                    <input type="tel" id="patientPhone" class="form-control" required>
                </div>

                <div class="form-group">
                    <label for="patientEmail">Email</label>
                    <input type="email" id="patientEmail" class="form-control">
                </div>

                <div class="stats-container">
                    <div class="form-group">
                        <label for="patientBloodGroup">Blood Group</label>
                        <select id="patientBloodGroup" class="form-control">
                            <option value="">Select Blood Group</option>
                            <option value="A+">A+</option>
                            <option value="A-">A-</option>
                            <option value="B+">B+</option>
                            <option value="B-">B-</option>
                            <option value="AB+">AB+</option>
                            <option value="AB-">AB-</option>
                            <option value="O+">O+</option>
                            <option value="O-">O-</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="patientAddress">Address</label>
                        <input type="text" id="patientAddress" class="form-control">
                    </div>
                </div>

                <div class="form-group">
                    <label for="patientMedicalHistory">Medical History</label>
                    <textarea id="patientMedicalHistory" class="form-control" rows="3"></textarea>
                </div>

                <div style="display: flex; gap: 10px;">
                    <button type="submit" class="btn btn-primary">Save Patient</button>
                    <button type="button" class="btn btn-danger" onclick="closePatientModal()">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Patient Details Modal -->
    <div id="viewPatientModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Patient Details</h2>
                <span class="close" onclick="closeViewPatientModal()">&times;</span>
            </div>
            <div id="patientDetails"></div>
            <button class="btn btn-primary" onclick="closeViewPatientModal()">Close</button>
        </div>
    </div>

    <footer>
        <p>&copy; 2024 AngalaEswari Hospital Management System. All rights reserved.</p>
    </footer>

    <script src="js/main.js"></script>
    <script>
        let patients = JSON.parse(localStorage.getItem('patients')) || [];

        // Check if user is logged in
        const currentUser = JSON.parse(localStorage.getItem('currentUser'));
        if (!currentUser) {
            window.location.href = 'login.html';
        }

        // Logout functionality
        document.getElementById('logoutBtn').addEventListener('click', function(e) {
            e.preventDefault();
            localStorage.removeItem('currentUser');
            window.location.href = 'login.html';
        });

        // Load patients on page load
        window.addEventListener('DOMContentLoaded', loadPatients);

        // Load all patients
        function loadPatients() {
            const tableBody = document.getElementById('patientsTableBody');
            
            if (patients.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="8">No patients found. Click "Add New Patient" to add one.</td></tr>';
                return;
            }

            tableBody.innerHTML = patients.map(patient => `
                <tr>
                    <td><strong>${patient.id}</strong></td>
                    <td>${patient.name}</td>
                    <td>${patient.age}</td>
                    <td>${patient.gender}</td>
                    <td>${patient.phone}</td>
                    <td>${patient.email || '-'}</td>
                    <td><span class="badge badge-info">${patient.bloodGroup || 'N/A'}</span></td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn btn-primary btn-sm" onclick="viewPatient('${patient.id}')">View</button>
                            <button class="btn btn-warning btn-sm" onclick="editPatient('${patient.id}')">Edit</button>
                            <button class="btn btn-danger btn-sm" onclick="deletePatient('${patient.id}')">Delete</button>
                        </div>
                    </td>
                </tr>
            `).join('');
        }

        // Search patients
        function searchPatients() {
            const searchTerm = document.getElementById('searchPatient').value.toLowerCase();
            const tableBody = document.getElementById('patientsTableBody');
            
            const filteredPatients = patients.filter(patient => 
                patient.name.toLowerCase().includes(searchTerm) ||
                patient.id.toLowerCase().includes(searchTerm) ||
                patient.phone.includes(searchTerm)
            );

            if (filteredPatients.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="8">No patients found matching your search.</td></tr>';
                return;
            }

            tableBody.innerHTML = filteredPatients.map(patient => `
                <tr>
                    <td><strong>${patient.id}</strong></td>
                    <td>${patient.name}</td>
                    <td>${patient.age}</td>
                    <td>${patient.gender}</td>
                    <td>${patient.phone}</td>
                    <td>${patient.email || '-'}</td>
                    <td><span class="badge badge-info">${patient.bloodGroup || 'N/A'}</span></td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn btn-primary btn-sm" onclick="viewPatient('${patient.id}')">View</button>
                            <button class="btn btn-warning btn-sm" onclick="editPatient('${patient.id}')">Edit</button>
                            <button class="btn btn-danger btn-sm" onclick="deletePatient('${patient.id}')">Delete</button>
                        </div>
                    </td>
                </tr>
            `).join('');
        }

        // Show add patient modal
        function showAddPatientModal() {
            document.getElementById('modalTitle').textContent = 'Add New Patient';
            document.getElementById('patientForm').reset();
            document.getElementById('patientId').value = '';
            document.getElementById('patientModal').style.display = 'block';
        }

        // Edit patient
        function editPatient(id) {
            const patient = patients.find(p => p.id === id);
            if (!patient) return;

            document.getElementById('modalTitle').textContent = 'Edit Patient';
            document.getElementById('patientId').value = patient.id;
            document.getElementById('patientName').value = patient.name;
            document.getElementById('patientAge').value = patient.age;
            document.getElementById('patientGender').value = patient.gender;
            document.getElementById('patientPhone').value = patient.phone;
            document.getElementById('patientEmail').value = patient.email || '';
            document.getElementById('patientBloodGroup').value = patient.bloodGroup || '';
            document.getElementById('patientAddress').value = patient.address || '';
            document.getElementById('patientMedicalHistory').value = patient.medicalHistory || '';
            
            document.getElementById('patientModal').style.display = 'block';
        }

        // View patient details
        function viewPatient(id) {
            const patient = patients.find(p => p.id === id);
            if (!patient) return;

            const detailsHtml = `
                <div class="stats-container">
                    <div><strong>Name:</strong> ${patient.name}</div>
                    <div><strong>ID:</strong> ${patient.id}</div>
                </div>
                <div class="stats-container">
                    <div><strong>Age:</strong> ${patient.age}</div>
                    <div><strong>Gender:</strong> ${patient.gender}</div>
                </div>
                <div class="stats-container">
                    <div><strong>Phone:</strong> ${patient.phone}</div>
                    <div><strong>Email:</strong> ${patient.email || 'N/A'}</div>
                </div>
                <div class="stats-container">
                    <div><strong>Blood Group:</strong> ${patient.bloodGroup || 'N/A'}</div>
                    <div><strong>Address:</strong> ${patient.address || 'N/A'}</div>
                </div>
                <div style="margin-top: 20px;">
                    <strong>Medical History:</strong>
                    <p>${patient.medicalHistory || 'No medical history recorded.'}</p>
                </div>
            `;

            document.getElementById('patientDetails').innerHTML = detailsHtml;
            document.getElementById('viewPatientModal').style.display = 'block';
        }

        // Delete patient
        function deletePatient(id) {
            if (confirm('Are you sure you want to delete this patient?')) {
                patients = patients.filter(p => p.id !== id);
                localStorage.setItem('patients', JSON.stringify(patients));
                loadPatients();
                showAlert('Patient deleted successfully!', 'success');
            }
        }

        // Close modals
        function closePatientModal() {
            document.getElementById('patientModal').style.display = 'none';
        }

        function closeViewPatientModal() {
            document.getElementById('viewPatientModal').style.display = 'none';
        }

        // Handle form submission
        document.getElementById('patientForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const patientId = document.getElementById('patientId').value;
            const patientData = {
                id: patientId || 'P' + Date.now(),
                name: document.getElementById('patientName').value,
                age: document.getElementById('patientAge').value,
                gender: document.getElementById('patientGender').value,
                phone: document.getElementById('patientPhone').value,
                email: document.getElementById('patientEmail').value,
                bloodGroup: document.getElementById('patientBloodGroup').value,
                address: document.getElementById('patientAddress').value,
                medicalHistory: document.getElementById('patientMedicalHistory').value,
                createdAt: patientId ? patients.find(p => p.id === patientId)?.createdAt : new Date().toISOString(),
                updatedAt: new Date().toISOString()
            };

            if (patientId) {
                // Update existing patient
                const index = patients.findIndex(p => p.id === patientId);
                patients[index] = patientData;
                showAlert('Patient updated successfully!', 'success');
            } else {
                // Add new patient
                patients.push(patientData);
                showAlert('Patient added successfully!', 'success');
            }

            localStorage.setItem('patients', JSON.stringify(patients));
            closePatientModal();
            loadPatients();
        });

        // Show alert message
        function showAlert(message, type) {
            const alertContainer = document.getElementById('alert-container');
            const alert = document.createElement('div');
            alert.className = `alert alert-${type}`;
            alert.textContent = message;
            alertContainer.appendChild(alert);
            
            setTimeout(() => {
                alert.remove();
            }, 3000);
        }

        // Close modal when clicking outside
        window.onclick = function(event) {
            if (event.target.classList.contains('modal')) {
                event.target.style.display = 'none';
            }
        }
    </script>
</body>
</html>
